<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="statinherit">
	<!-- 상속통계표는 공표구분에 따라.. -->
	<sql id="inherit_pub_se">
		DECODE( (SELECT PUB_SE_TYPE FROM $dbUser$TN_STAT_INHERIT_INFO WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#), '1', PUB_SE, '1210110')
	</sql>

	<!-- 통계표담당자,공표구분에 따른 주기 -->
	<sql id="selectPeriodPubSe">
		<![CDATA[
			AND B.PRD_DE BETWEEN
            CASE 
                WHEN A.STRT_RSTR_DE IS NOT NULL AND A.STRT_RLS_DE IS NOT NULL AND SYSDATE < A.STRT_RLS_DE THEN
                    CASE 
                        WHEN A.STRT_RSTR_DE < (SELECT MIN(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND 
						]]>
                        <include refid="statinherit.inherit_pub_se"/>
                        <include refid="common.pub_se"/>
						<![CDATA[
                        ) THEN
                            (SELECT MIN(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND  
                            ]]>
	                        <include refid="statinherit.inherit_pub_se"/>
                            <include refid="common.pub_se"/>
							<![CDATA[
                            )
                        ELSE A.STRT_RSTR_DE
                    END
                ELSE 
                    (SELECT MIN(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND  
                    ]]>
	                <include refid="statinherit.inherit_pub_se"/>
                    <include refid="common.pub_se"/>
					<![CDATA[
                    )
            END
            AND 
            CASE 
                WHEN A.END_RSTR_DE IS NOT NULL AND A.END_RLS_DE IS NOT NULL AND SYSDATE < A.END_RLS_DE THEN 
                    CASE 
                        WHEN A.END_RSTR_DE > (SELECT MAX(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND  
                        ]]>
	                	<include refid="statinherit.inherit_pub_se"/>
                        <include refid="common.pub_se"/>
						<![CDATA[
                        ) THEN 
                            (SELECT MAX(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND  
                            ]]>
	               			<include refid="statinherit.inherit_pub_se"/>
                            <include refid="common.pub_se"/>
						<![CDATA[
                            )
                        ELSE A.END_RSTR_DE
                    END 
                ELSE 
                    (SELECT MAX(PRD_DE) FROM $dbUser$TN_RECD_PRD WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PRD_SE = A.PRD_SE AND PRD_DE BETWEEN A.STRT_PRD_DE AND A.END_PRD_DE AND  
                    ]]>
	                <include refid="statinherit.inherit_pub_se"/>
                    <include refid="common.pub_se"/>
					<![CDATA[
                    )
            END
		]]>
	</sql>
	
	<select id="getStatInheritInfo" parameterClass="map" resultClass="egovMap">
		SELECT IST.ORG_ID,
		       IST.TBL_ID,
		       IST.REFER_ORG_ID,
		       IST.REFER_TBL_ID,
		       IST.FST_REG_DE,
		       IST.FST_REG_NM,
		       IST.LST_CHN_DE,
		       IST.LST_CHN_NM,
		       ST.TBL_NM,
		       ST.MAKE_AT,
		       IST.PUB_SE_TYPE
		  FROM $dbUser$TN_STAT_INHERIT_INFO IST, $dbUser$TN_STBL_INFO ST
		 WHERE 1 = 1 
		   AND IST.ORG_ID = #orgId# 
		   AND IST.TBL_ID = #tblId#
		   AND IST.ORG_ID = ST.ORG_ID 
		   AND IST.TBL_ID = ST.TBL_ID
	</select>
	
	<!-- 20151204 남규옥 ::: TBL_SE 추가(분류없는통계표상속일경우 구분필요) -->
	<select id="selectInheritMainInfo" parameterClass="map" resultClass="hmap" remapResults="true">
		<![CDATA[
		SELECT A.TBL_NM,
		       A.TBL_ID,
		       A.TBL_SE,
		       NVL (A.TBL_ENG_NM, ' ') AS TBL_ENG_NM,
		       A.CHAR_ITM_CO,
		       DECODE (A.DIM_UNIT_YN, 'Y', 'Y', 'N') AS DIM_UNIT_YN,
		       DECODE (A.WGT_YN, 'Y', 'Y', 'N') AS WGT_YN,
		       A.UNIT_ID,
		       DECODE (A.UNIT_ID, NULL, NULL, (SELECT CD_NM FROM $dbUser$TC_UNIT WHERE CD_ID = A.UNIT_ID)) AS UNIT_NM_KOR,
		       DECODE (A.UNIT_ID, NULL, NULL, (SELECT CD_ENG_NM FROM $dbUser$TC_UNIT WHERE CD_ID = A.UNIT_ID)) AS UNIT_NM_ENG,
		       (CASE A.CMMT_AT
		           WHEN 'Y'
		           THEN
		              CASE
		                 WHEN (SELECT COUNT (1)
		                         FROM $dbUser$TN_CMMT_INFO
		                        WHERE     ORG_ID = A.ORG_ID
		                              AND TBL_ID = A.TBL_ID
		                              AND CMMT_SE = '1210610'
		                              AND LNG_SE = '1211910') > 0
		                 THEN 'Y'
		                 ELSE 'N'
		              END
		           ELSE 'N'
		        END)
		          AS EXIST_STBL_CMMT_KOR,
		       (CASE A.CMMT_AT
		           WHEN 'Y'
		           THEN
		              CASE
		                 WHEN (SELECT COUNT (1)
		                         FROM $dbUser$TN_CMMT_INFO
		                        WHERE     ORG_ID = A.ORG_ID
		                              AND TBL_ID = A.TBL_ID
		                              AND CMMT_SE = '1210610'
		                              AND LNG_SE = '1211911') > 0
		                 THEN 'Y'
		                 ELSE 'N'
		              END
		           ELSE 'N'
		        END)
		          AS EXIST_STBL_CMMT_ENG,
		       DECODE (
		          (SELECT COUNT (1)
		             FROM $dbUser$TN_CMMT_INFO
		            WHERE     ORG_ID = A.ORG_ID
		                  AND TBL_ID = A.TBL_ID
		                  AND LNG_SE = '1211910'),
		          0, 'N', 'Y') AS EXIST_CMMT_KOR,
		       DECODE (
		          (SELECT COUNT (1)
		             FROM $dbUser$TN_CMMT_INFO
		            WHERE     ORG_ID = A.ORG_ID
		                  AND TBL_ID = A.TBL_ID
		                  AND CMMT_SE = '1210610'
		                  AND LNG_SE = '1211911'),
		          0, 'N', 'Y') AS EXIST_CMMT_ENG,
		       A.OLAP_STL,
		       NVL (A.DIM_CO, 0) AS DIM_CO,
		       $dbUser$FN_GET_STBL_PRD_SEARCH(A.ORG_ID, A.TBL_ID, #dbUser#, #serverType#, #language#, #dataOpt#) AS CONTAIN_PERIOD,
		       (WITH LIST
		       		AS (
				       SELECT MAX(SEND_DE) AS SEND_DE, MAX(LST_CHN_DE) AS LST_CHN_DE FROM( SELECT NVL (
				                  TO_CHAR (MAX (SEND_DE), 'YYYYMMDD'),
				                  MAX (
				                     TO_CHAR (
				                        TO_DATE (
				                           CASE
				                              WHEN LENGTH (S2.LST_CHN_DE) = 8
				                                   AND INSTR (S2.LST_CHN_DE, '/') = 0
				                              THEN
				                                 TO_DATE (S2.LST_CHN_DE, 'YYYYMMDD')
				                              WHEN LENGTH (S2.LST_CHN_DE) = 8
				                                   AND INSTR (S2.LST_CHN_DE,
				                                              '/',
				                                              1,
				                                              2) = 6
				                              THEN
				                                 TO_DATE (S2.LST_CHN_DE, 'YY/MM/DD')
				                              ELSE
				                                 NULL
				                           END),
				                        'YYYYMMDD')))
				                  AS SEND_DE, S1.LST_CHN_DE, A.ORG_ID, A.TBL_ID
				          FROM $dbUser$TN_STBL_RECD_INFO S1, $dbUser$TN_RECD_PRD S2, $dbUser$TN_STBL_INFO a
				         WHERE     S1.ORG_ID = S2.ORG_ID
				               AND S1.TBL_ID = S2.TBL_ID
				               AND S1.ORG_ID = A.ORG_ID
				               AND S1.TBL_ID = A.TBL_ID
				               AND  A.ORG_ID = #orginOrgId# AND A.TBL_ID = #orginTblId#
				               AND S1.PRD_SE = S2.PRD_SE
				               AND DECODE( (SELECT PUB_SE_TYPE FROM $dbUser$TN_STAT_INHERIT_INFO WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#), '1', S1.PUB_SE, '1210110') 
			        ]]>
			        
                   			<include refid="common.pub_se"/>

			        <![CDATA[
				               AND S2.PRD_DE BETWEEN (CASE
				                                         WHEN     S1.STRT_RLS_DE IS NOT NULL
				                                              AND S1.STRT_RSTR_DE IS NOT NULL
				                                              AND S1.STRT_RLS_DE >= SYSDATE
				                                         THEN
				                                            S1.STRT_RSTR_DE
				                                         ELSE
				                                            S1.STRT_PRD_DE
				                                      END)
				                                 AND (CASE
				                                         WHEN     S1.END_RLS_DE IS NOT NULL
				                                              AND S1.END_RSTR_DE IS NOT NULL
				                                              AND S1.END_RLS_DE >= SYSDATE
				                                         THEN
				                                            S1.END_RSTR_DE
				                                         ELSE
				                                            S1.END_PRD_DE
				                                      END)
				               GROUP BY S1.LST_CHN_DE, A.ORG_ID, A.TBL_ID
				               ) B )
				               SELECT
				                  CASE 
				                    WHEN SEND_DE > LST_CHN_DE THEN TO_CHAR(TO_DATE(SEND_DE, 'YYYYMMDDHH24MI'), 'YYYY-MM-DD')
				                    WHEN LST_CHN_DE > SEND_DE THEN TO_CHAR(TO_DATE(LST_CHN_DE, 'YYYYMMDDHH24MI'), 'YYYY-MM-DD')
				                    ELSE DECODE(SEND_DE, NULL, TO_CHAR(TO_DATE(LST_CHN_DE, 'YYYYMMDDHH24MI'), 'YYYY-MM-DD'), TO_CHAR(TO_DATE(SEND_DE, 'YYYYMMDDHH24MI'), 'YYYY-MM-DD')) 
				                END BIG_DE 
				               FROM LIST
				               ) AS RENEWAL_DATE,
		       A.STAT_ID,
		       SUBSTR (A.PUB_SE, -1) AS PUB,
		       (SELECT ORG_NM FROM $dbUser$TN_ORG C WHERE A.ORG_ID = C.ORG_ID) AS ORG_NM
			        ]]>
            	<isEqual property="serverTypeOrigin" compareValue="service">
					<isEqual property="serverLocation" compareValue="NSO">
	                	, (SELECT DECODE(COUNT(1), 0, 'N', 'Y') FROM $dbUser$TN_MASS WHERE ORG_ID = A.ORG_ID AND TBL_ID = A.TBL_ID AND PROC_SE = 'F' AND SERVICE_AT = 'Y') AS MASS_YN
	                </isEqual>
            	</isEqual>         		
		  FROM $dbUser$TN_STBL_INFO A
		 WHERE     A.ORG_ID = #orgId#
		       AND A.TBL_ID = #tblId#
	</select>
	
	<!-- 분류 주석 -->
	<select id="selectClassCmmt" resultClass="string">
		<![CDATA[
			SELECT	CMMT_DC
			FROM 	$dbUser$TN_CMMT_INFO
			WHERE	ORG_ID = #originOrgId#
					AND TBL_ID = #originTblId#
					AND OBJ_VAR_ID = #objVarId#
					AND CMMT_SE = #cmmtSe#
					AND LNG_SE = #lngSe#
			ORDER BY LINE_SN
		]]>
	</select>
	
	<!-- 다운용 주석 (통계표 1210610, 항목 1210611, 분류 1210612, ITM 1210613 -->
	<select id="selectExcelCmmtList" parameterClass="map" resultClass="egovMap">
		  SELECT RS.*,
		  <![CDATA[
		         CASE
		            WHEN CMMT_SE = '1210610' THEN DECODE(INSTR ('ko', 'en'), -1, 'TABLE : ', '통계표 : ')
		            WHEN CMMT_SE = '1210611' THEN DECODE(INSTR ('ko', 'en'), -1, SCR_ENG || ' : ', SCR_KOR || ' : ')
		            WHEN CMMT_SE = '1210612' OR CMMT_SE = '1210613' THEN DECODE(INSTR ('ko', 'en'), -1, SCR_ENG || ' : ', SCR_KOR || ' : ')
		         END AS TITLE,
		  ]]>
		         CASE
		            WHEN CMMT_SE = '1210610' THEN 0
		            WHEN CMMT_SE = '1210611' THEN CHAR_ITM_SN
		            WHEN CMMT_SE = '1210612' THEN VAR_ORD_SN
		            WHEN CMMT_SE = '1210613' THEN CHAR_ITM_SN
		         END AS SN,
		         RANK () OVER (PARTITION BY RS.ITM_ID ORDER BY RS.LINE_SN) RNUM
		    FROM (
		    
		          SELECT ORG_ID, TBL_ID,
		                 CMMT_SN, CMMT_SE, VAR_LVL_CO, OBJ_VAR_ID, ITM_ID, ITM_RCGN_SN, PRD_SE, PRD_DE,
		                 LINE_SN, LNG_SE, CMMT_DC, LST_CHN_DE, LST_CHN_NM,
		                 NULL AS VAR_ORD_SN, NULL AS CHAR_ITM_SN, NULL AS SCR_KOR, NULL AS SCR_ENG
		            FROM $dbUser$TN_CMMT_INFO
		           WHERE     CMMT_SE = '1210610'
		                 AND ORG_ID = #orgId#
		                 AND TBL_ID = #tblId#
		          UNION ALL
		          SELECT D.ORG_ID, D.TBL_ID, 
		                 A.CMMT_SN, A.CMMT_SE, A.VAR_LVL_CO, A.OBJ_VAR_ID, A.ITM_ID, A.ITM_RCGN_SN, A.PRD_SE, A.PRD_DE,
		                 A.LINE_SN, A.LNG_SE, A.CMMT_DC, A.LST_CHN_DE, A.LST_CHN_NM,
		                 D.VAR_ORD_SN, D.CHAR_ITM_SN, D.SCR_KOR, D.SCR_ENG
		            FROM $dbUser$TN_CMMT_INFO A,
		                 (SELECT ORG_ID, TBL_ID, OBJ_VAR_ID, VAR_ORD_SN, NULL AS ITM_ID, 
		                 		 NULL AS ITM_RCGN_SN, NULL AS CHAR_ITM_SN, SCR_KOR, SCR_ENG
		                    FROM $dbUser$TN_OBJ_ITM_CLS
		                   WHERE     ORG_ID = #orgId#
		                         AND TBL_ID = #tblId#
		                         AND CMMT_AT = 'Y'
		                  UNION ALL
		                  SELECT ITM.ORG_ID, ITM.TBL_ID, 
		                  		 ITM.OBJ_VAR_ID, NULL AS VAR_ORD_SN, ITM.ITM_ID, 
		                  		 NULL ITM_RCGN_SN, ITM.CHAR_ITM_SN,
		                         DECODE(ITM.CHAR_ITM_AT, 'Y', '항목', OBJ.SCR_KOR) || ' > ' || ITM.SCR_KOR AS SCR_KOR, 
		                         DECODE(ITM.CHAR_ITM_AT, 'Y', 'Item', OBJ.SCR_ENG) || ' > ' || ITM.SCR_ENG AS SCR_ENG
		                    FROM $dbUser$TN_OBJ_ITM_CLS OBJ, $dbUser$TN_ITM_LIST ITM
		                   WHERE     OBJ.ORG_ID = #orgId#
		                         AND OBJ.TBL_ID = #tblId#
		                         AND OBJ.ORG_ID = ITM.ORG_ID AND OBJ.TBL_ID = ITM.TBL_ID
		                         AND OBJ.OBJ_VAR_ID = ITM.OBJ_VAR_ID
		                         AND ITM.CMMT_AT = 'Y'
		                  UNION ALL
		                  SELECT ORG_ID, TBL_ID, NULL AS OBJ_VAR_ID, NULL AS VAR_ORD_SN, NULL AS ITM_ID, 
		                  		 ITM_RCGN_SN, NULL AS CHAR_ITM_SN, NULL AS SCR_KOR, NULL AS SCR_ENG
		                    FROM $dbUser$TN_DIM
		                   WHERE     ORG_ID = #orgId#
		                         AND TBL_ID = #tblId#
		                         AND CMMT_AT = 'Y') D
		           WHERE     1 = 1
		                 AND A.ORG_ID = #originOrgId#
		                 AND A.TBL_ID = #originTblId#
		                 AND CMMT_SE IN ('1210611', '1210612', '1210613')
		                 AND SYS_OP_MAP_NONNULL (A.OBJ_VAR_ID) = SYS_OP_MAP_NONNULL (D.OBJ_VAR_ID)
		                 AND SYS_OP_MAP_NONNULL (A.ITM_ID) = SYS_OP_MAP_NONNULL (D.ITM_ID)
		                 AND SYS_OP_MAP_NONNULL (A.ITM_RCGN_SN) = SYS_OP_MAP_NONNULL (D.ITM_RCGN_SN)
		                 
		        )RS
		   WHERE 1 = 1
		   <isNotEmpty property="cmmtSe">
		     AND CMMT_SE = #cmmtSe# 
		   </isNotEmpty>
		     AND LNG_SE = #lngSe#
		ORDER BY CMMT_SE, SN, RNUM
	</select>
	
	<!-- 주석 모두 -->
	<select id="selectAllCmmtList" parameterClass="map" resultClass="egovMap">
		  SELECT RS.*,
		  <![CDATA[
		         CASE
		            WHEN CMMT_SE = '1210610' THEN DECODE(INSTR ('ko', 'en'), -1, 'TABLE : ', '통계표 : ')
		            WHEN CMMT_SE = '1210611' THEN DECODE(INSTR ('ko', 'en'), -1, SCR_ENG || ' : ', SCR_KOR || ' : ')
		            WHEN CMMT_SE = '1210612' OR CMMT_SE = '1210613' THEN DECODE(INSTR ('ko', 'en'), -1, SCR_ENG || ' : ', SCR_KOR || ' : ')
		         END AS TITLE,
		  ]]>
		         CASE
		            WHEN CMMT_SE = '1210610' THEN 0
		            WHEN CMMT_SE = '1210611' THEN CHAR_ITM_SN
		            WHEN CMMT_SE = '1210612' THEN VAR_ORD_SN
		            WHEN CMMT_SE = '1210613' THEN CHAR_ITM_SN
		         END AS SN,
		         RANK () OVER (PARTITION BY RS.ITM_ID ORDER BY RS.LINE_SN) RNUM
		    FROM (
		    
		          SELECT ORG_ID, TBL_ID,
		                 CMMT_SN, CMMT_SE, VAR_LVL_CO, OBJ_VAR_ID, ITM_ID, ITM_RCGN_SN, PRD_SE, PRD_DE,
		                 LINE_SN, LNG_SE, CMMT_DC, LST_CHN_DE, LST_CHN_NM,
		                 NULL AS VAR_ORD_SN, NULL AS CHAR_ITM_SN, NULL AS SCR_KOR, NULL AS SCR_ENG
		            FROM $dbUser$TN_CMMT_INFO
		           WHERE     CMMT_SE = '1210610'
		                 AND ORG_ID = #orgId#
		                 AND TBL_ID = #tblId#
		          UNION ALL
		          SELECT D.ORG_ID, D.TBL_ID, 
		                 A.CMMT_SN, A.CMMT_SE, A.VAR_LVL_CO, A.OBJ_VAR_ID, A.ITM_ID, A.ITM_RCGN_SN, A.PRD_SE, A.PRD_DE,
		                 A.LINE_SN, A.LNG_SE, A.CMMT_DC, A.LST_CHN_DE, A.LST_CHN_NM,
		                 D.VAR_ORD_SN, D.CHAR_ITM_SN, D.SCR_KOR, D.SCR_ENG
		            FROM $dbUser$TN_CMMT_INFO A,
		                 (SELECT ORG_ID, TBL_ID, OBJ_VAR_ID, VAR_ORD_SN, NULL AS ITM_ID, 
		                 		 NULL AS ITM_RCGN_SN, NULL AS CHAR_ITM_SN, SCR_KOR, SCR_ENG
		                    FROM $dbUser$TN_OBJ_ITM_CLS
		                   WHERE     ORG_ID = #orgId#
		                         AND TBL_ID = #tblId#
		                         AND CMMT_AT = 'Y'
		                  UNION ALL
		                  SELECT ITM.ORG_ID, ITM.TBL_ID, 
		                  		 ITM.OBJ_VAR_ID, NULL AS VAR_ORD_SN, ITM.ITM_ID, 
		                  		 NULL ITM_RCGN_SN, ITM.CHAR_ITM_SN,
		                         DECODE(ITM.CHAR_ITM_AT, 'Y', '항목', OBJ.SCR_KOR) || ' > ' || ITM.SCR_KOR AS SCR_KOR, 
		                         DECODE(ITM.CHAR_ITM_AT, 'Y', 'Item', OBJ.SCR_ENG) || ' > ' || ITM.SCR_ENG AS SCR_ENG
		                    FROM $dbUser$TN_OBJ_ITM_CLS OBJ, $dbUser$TN_ITM_LIST ITM
		                   WHERE     OBJ.ORG_ID = #orgId#
		                         AND OBJ.TBL_ID = #tblId#
		                         AND OBJ.ORG_ID = ITM.ORG_ID AND OBJ.TBL_ID = ITM.TBL_ID
		                         AND OBJ.OBJ_VAR_ID = ITM.OBJ_VAR_ID
		                         AND ITM.CMMT_AT = 'Y'
		                  UNION ALL
		                  SELECT ORG_ID, TBL_ID, NULL AS OBJ_VAR_ID, NULL AS VAR_ORD_SN, NULL AS ITM_ID, 
		                  		 ITM_RCGN_SN, NULL AS CHAR_ITM_SN, NULL AS SCR_KOR, NULL AS SCR_ENG
		                    FROM $dbUser$TN_DIM
		                   WHERE     ORG_ID = #orgId#
		                         AND TBL_ID = #tblId#
		                         AND CMMT_AT = 'Y') D
		           WHERE     1 = 1
		                 AND A.ORG_ID = #originOrgId#
		                 AND A.TBL_ID = #originTblId#
		                 AND CMMT_SE != '1210610'
		                 AND SYS_OP_MAP_NONNULL (A.OBJ_VAR_ID) = SYS_OP_MAP_NONNULL (D.OBJ_VAR_ID)
		                 AND SYS_OP_MAP_NONNULL (A.ITM_ID) = SYS_OP_MAP_NONNULL (D.ITM_ID)
		                 AND SYS_OP_MAP_NONNULL (A.ITM_RCGN_SN) = SYS_OP_MAP_NONNULL (D.ITM_RCGN_SN)
		                 
		        )RS
		   WHERE 1 = 1
		   <isNotEmpty property="cmmtSe">
		     AND CMMT_SE = #cmmtSe# 
		   </isNotEmpty>
		     AND LNG_SE = #lngSe#
		ORDER BY CMMT_SE, SN, RNUM
	</select>
	
	<!-- 분류값, 항목 주석 -->
	<select id="selectClassItemCmmt" resultClass="string">
		<![CDATA[
			SELECT	CMMT_DC
			FROM 	$dbUser$TN_CMMT_INFO
			WHERE	ORG_ID = #originOrgId#
					AND TBL_ID = #originTblId#
					AND OBJ_VAR_ID = #objVarId#
					AND ITM_ID = #itmId#
					AND CMMT_SE = #cmmtSe#
					AND LNG_SE = #lngSe#
			ORDER BY LINE_SN
		]]>
	</select>
	
	<!-- 차원 주석 -->
	<select id="selectDimCmmt" resultClass="string">
		<![CDATA[
			SELECT	CMMT_DC
			FROM 	$dbUser$TN_CMMT_INFO
			WHERE	ORG_ID = #originOrgId#
					AND TBL_ID = #originTblId#
					AND ITM_RCGN_SN = #itmRcgnSn#
					AND CMMT_SE = #cmmtSe#
					AND LNG_SE = #lngSe#
			ORDER BY LINE_SN
		]]>
	</select>
	
	<!-- 해당 주석 가져오기 -->
	<select id="selectCmmtStr" resultClass="string">
		<![CDATA[
			SELECT	CMMT_DC
			FROM 	$dbUser$TN_CMMT_INFO
			WHERE	ORG_ID = DECODE(#cmmtSe#, '1210610', #orgId#, #originOrgId#)
					AND TBL_ID = DECODE(#cmmtSe#, '1210610', #tblId#, #originTblId#)
		]]>
					<isEqual property="cmmtSe" compareValue="1210612">
						<![CDATA[
   						AND OBJ_VAR_ID = #objVarId#
   						]]>
   					</isEqual>
   					<isEqual property="cmmtSe" compareValue="1210611">
						<![CDATA[
   						AND OBJ_VAR_ID = #objVarId#
   						AND ITM_ID = #itmId#
   						]]>
   					</isEqual>
   					<isEqual property="cmmtSe" compareValue="1210613">
						<![CDATA[
   						AND OBJ_VAR_ID = #objVarId#
   						AND ITM_ID = #itmId#
   						]]>
   					</isEqual>
   					<isEqual property="cmmtSe" compareValue="1210614">
						<![CDATA[
   						AND ITM_RCGN_SN = #itmRcgnSn#
   						]]>
   					</isEqual>
		<![CDATA[
					AND CMMT_SE = #cmmtSe#
					AND LNG_SE = #lngSe#
			ORDER BY LINE_SN
		]]>
	</select>
	<!-- 주석들 END -->
	
	<select id="selectDimensionInfo" parameterClass="map" resultClass="hmap">
		<![CDATA[
		SELECT 	
				CASE B.CMMT_AT
             		WHEN 'Y' THEN
                		CASE 
                    		WHEN (
                    				SELECT 	COUNT(1) FROM $dbUser$TN_CMMT_INFO
                            		WHERE 	ORG_ID = B.ORG_ID AND TBL_ID = B.TBL_ID
                                			AND CMMT_SE = '1210612' AND LNG_SE = '1211910' AND OBJ_VAR_ID = B.OBJ_VAR_ID) > 0 THEN
                        		'Y'
                    		ELSE
                        		'N'
                		END                        
            		ELSE
                		'N'
          		END AS CMMT_AT_KOR,            
          		CASE B.CMMT_AT
             		WHEN 'Y' THEN
                		CASE 
                    		WHEN (
                    				SELECT 	COUNT(1) FROM $dbUser$TN_CMMT_INFO
                            		WHERE 	ORG_ID = B.ORG_ID AND TBL_ID = B.TBL_ID
                                			AND CMMT_SE = '1210612' AND LNG_SE = '1211911' AND OBJ_VAR_ID = B.OBJ_VAR_ID) > 0 THEN
                        		'Y'
                   			 ELSE
                        		'N'
                		END                        
            		ELSE
                		'N'
          		END AS CMMT_AT_ENG
				, NVL(A.SCR_KOR, ' ') SCR_KOR
				, NVL(A.SCR_ENG, ' ') SCR_ENG
				, A.VAR_ORD_SN
				, A.OBJ_VAR_ID
				, A.TOT_IGNR_AT
		FROM 	$dbUser$TN_OBJ_ITM_CLS A, $dbUser$TN_OBJ_ITM_CLS B
		WHERE	A.ORG_ID = #orgId# AND A.TBL_ID = #tblId#
				AND B.ORG_ID = #originOrgId# AND B.TBL_ID = #originTblId#
				AND A.OBJ_VAR_ID = #objVarId#
				AND A.OBJ_VAR_ID = B.OBJ_VAR_ID
		]]>
	</select>
	
	<select id="selectClassDimensionList" parameterClass="map" resultClass="hmap">
		<![CDATA[
		WITH TMP AS
		(
     		SELECT * 
     		FROM 	$dbUser$TN_ITM_LIST
    		WHERE  	ORG_ID = #orgId#
                    AND TBL_ID = #tblId#
                    AND OBJ_VAR_ID = #objVarId#
		)
		, ITM_LIST AS 
		(
			SELECT 	LEVEL LVL
                    , ORG_ID
                    , TBL_ID
                    , OBJ_VAR_ID
                    , ITM_ID
                    , LPAD(' ',(LEVEL-1)*3, ' ')|| ITM_ID AS  VIEW_ITM_ID
                    , LPAD(' ',(LEVEL-1)*3, ' ')|| SCR_KOR AS  VIEW_SCR_KOR
                    , LPAD(' ',(LEVEL-1)*3, ' ')|| SCR_ENG AS  VIEW_SCR_ENG
                    , SYS_CONNECT_BY_PATH (ITM_ID, '@') AS PARENT_CODE
                    , NVL (SYS_CONNECT_BY_PATH (NVL(SCR_KOR, ' '), '@'), ' ') AS PARENT_NAME_KOR
                    , NVL (SYS_CONNECT_BY_PATH (NVL(SCR_ENG, ' '), '@'), ' ') AS PARENT_NAME_ENG
                    , ROWNUM AS RNUM
            FROM	TMP
            START WITH UP_ITM_ID IS NULL
            CONNECT BY PRIOR ITM_ID = UP_ITM_ID
            ORDER SIBLINGS BY CHAR_ITM_SN, ITM_ID
		)
		SELECT	/*+  ordered*/ C.LVL
            	, B.ITM_ID
            	, VIEW_ITM_ID
            	, VIEW_SCR_KOR
            	, VIEW_SCR_ENG
            	, NVL (B.SCR_KOR, ' ') AS SCR_KOR
            	, NVL (B.SCR_ENG, ' ') AS SCR_ENG
            	, B.UP_ITM_ID
            	, SUBSTR (C.PARENT_CODE, 2, INSTR (C.PARENT_CODE, '@', -1) - 1) AS PARENT_CODE
            	, SUBSTR (C.PARENT_NAME_KOR, 2, INSTR (C.PARENT_NAME_KOR, '@', -1) - 1) AS PARENT_NAME_KOR
            	, SUBSTR (C.PARENT_NAME_ENG, 2, INSTR (C.PARENT_NAME_ENG, '@', -1) - 1) AS PARENT_NAME_ENG
            	, D.UNIT_ID
            	, DECODE (D.UNIT_ID, NULL, NULL, (SELECT NVL(CD_NM, ' ')
                              					FROM $dbUser$TC_UNIT
                             					WHERE CD_ID = D.UNIT_ID)) AS UNIT_NM_KOR
            	, DECODE (D.UNIT_ID, NULL, NULL, (SELECT NVL(CD_ENG_NM, ' ')
                         						FROM $dbUser$TC_UNIT
                        						WHERE CD_ID = D.UNIT_ID)) AS UNIT_NM_ENG                      
            	, CASE D.CMMT_AT
          		  	WHEN 'Y' THEN 
          		  		CASE
                        	WHEN (
                        			SELECT 	COUNT (1)
                                   	FROM 	$dbUser$TN_CMMT_INFO
                                  	WHERE   ORG_ID = D.ORG_ID
                                        	AND TBL_ID = D.TBL_ID
                                        	AND CMMT_SE = '1210613'
                                        	AND LNG_SE = '1211910'
	                                        AND OBJ_VAR_ID = D.OBJ_VAR_ID
    	                                    AND ITM_ID = D.ITM_ID
    	                          ) > 0 THEN 
    	                   		'Y'
                           	ELSE 
                           		'N'
                        END
          			ELSE 
          				'N'
       			END AS CMMT_AT_KOR,
       			CASE D.CMMT_AT
          			WHEN 'Y' THEN 
          				CASE
                        	WHEN (
                           			SELECT	COUNT (1)
                                   	FROM 	$dbUser$TN_CMMT_INFO
                                  	WHERE   ORG_ID = D.ORG_ID
                                        	AND TBL_ID = D.TBL_ID
                                        	AND CMMT_SE = '1210613'
                                        	AND LNG_SE = '1211911'
                                        	AND OBJ_VAR_ID = D.OBJ_VAR_ID
                                        	AND ITM_ID = D.ITM_ID
                                 ) > 0 THEN
                           
                           		'Y'
                           	ELSE 
                           		'N'
                        END
          			ELSE 
          				'N'
       			END AS CMMT_AT_ENG
		FROM 	(
					SELECT	TO_CHAR (TARGET_VALUE)  AS ITM_ID
                 	FROM 	$condTable$
				 	WHERE 	SESSION_ID = #sessionId#
                 			AND TARGET_ID = #targetId#
                 ) A
                 , $dbUser$TN_ITM_LIST B
                 , ITM_LIST C
                 , $dbUser$TN_ITM_LIST D
		WHERE 	B.ORG_ID = #orgId# AND B.TBL_ID = #tblId# AND B.OBJ_VAR_ID = #objVarId#
        		AND D.ORG_ID = #originOrgId# AND D.TBL_ID = #originTblId#
        		AND B.ORG_ID = C.ORG_ID
        		AND B.TBL_ID = C.TBL_ID
        		AND B.OBJ_VAR_ID = C.OBJ_VAR_ID
        		AND B.OBJ_VAR_ID = D.OBJ_VAR_ID
        		AND B.ITM_ID = C.ITM_ID
        		AND A.ITM_ID = B.ITM_ID
        		AND B.ITM_ID = D.ITM_ID
		ORDER BY RNUM
		]]>
	</select>
	
	<select id="selectItemDimensionList" parameterClass="map" resultClass="hmap">
		<![CDATA[
		SELECT	A.ITM_ID, NVL(A.SCR_KOR, ' ') AS SCR_KOR, NVL(A.SCR_ENG, ' ') AS SCR_ENG
				, B.UNIT_ID
				, DECODE(B.UNIT_ID, NULL, NULL, (SELECT NVL(CD_NM, ' ') FROM $dbUser$TC_UNIT WHERE CD_ID = B.UNIT_ID)) AS UNIT_NM_KOR
				, DECODE(B.UNIT_ID, NULL, NULL, (SELECT NVL(CD_ENG_NM, ' ') FROM $dbUser$TC_UNIT WHERE CD_ID = B.UNIT_ID)) AS UNIT_NM_ENG
				, CASE B.CMMT_AT
          		  	WHEN 'Y' THEN 
          		  		CASE
          		  			WHEN (	SELECT 	COUNT (1)
                                   	FROM 	$dbUser$TN_CMMT_INFO
                                  	WHERE   ORG_ID = B.ORG_ID
                                        	AND TBL_ID = B.TBL_ID
                                        	AND CMMT_SE = '1210611'
                                        	AND LNG_SE = '1211910'
                                        	AND OBJ_VAR_ID = A.OBJ_VAR_ID
                                        	AND ITM_ID = A.ITM_ID) > 0 THEN 
                            	'Y'
                           	ELSE 
                           		'N'
                        END
          			ELSE 
          				'N'
       			  END AS CMMT_AT_KOR
          		, CASE B.CMMT_AT
          		  	WHEN 'Y' THEN 
          		  		CASE
          		  			WHEN (	SELECT 	COUNT (1)
                                   	FROM 	$dbUser$TN_CMMT_INFO
                                  	WHERE   ORG_ID = B.ORG_ID
                                        	AND TBL_ID = B.TBL_ID
                                        	AND CMMT_SE = '1210611'
                                        	AND LNG_SE = '1211911'
                                        	AND OBJ_VAR_ID = A.OBJ_VAR_ID
                                        	AND ITM_ID = A.ITM_ID) > 0 THEN 
                            	'Y'
                           	ELSE 
                           		'N'
                        END
          			ELSE 
          				'N'
       			  END AS CMMT_AT_ENG
		FROM 	$dbUser$TN_ITM_LIST A, $dbUser$TN_ITM_LIST B
		WHERE 	A.ORG_ID = #orgId#
           		AND A.TBL_ID = #tblId#
				AND B.ORG_ID = #originOrgId# AND B.TBL_ID = #originTblId#
           		AND A.OBJ_VAR_ID = '13999001'
           		AND A.OBJ_VAR_ID = B.OBJ_VAR_ID
           		AND A.ITM_ID IN
                (
                	SELECT 	TARGET_VALUE
                    FROM 	$condTable$
                    WHERE 	SESSION_ID = #sessionId#
                            AND TARGET_ID = 'ITM_ID'
				)
           		AND A.ITM_ID = B.ITM_ID
		ORDER BY A.CHAR_ITM_SN, A.ITM_ID				
		]]>
	</select>
	
	<!-- 통계표부호 SMBL_CN 가져오기 -->
	<select id="selectRecdPrdSmblCn" parameterClass="map" resultClass="hmap">
		<![CDATA[
		SELECT 	PRD_SE||PRD_DE AS CODE, SMBL_CN
		FROM 	$dbUser$TN_RECD_PRD
		WHERE  	ORG_ID = #originOrgId#
           		AND TBL_ID = #originTblId#
           		AND PRD_SE||PRD_DE
        ]]>
        	<iterate property="prdList" prepend="IN" open="(" conjunction="," close=")">
        	<![CDATA[           		
        		#prdList[]#
			]]>
        	</iterate>
	</select>
	
<!-- 2019.07.04 EXIST문이 느려서  STAR 힌트추가 -->
<!-- 20.04.09 업무용에서 담당자가 st 파라미터를 이용하여 서비스용으로 조회할때 원래 serverType은 관리자 였으므로 기간보안 체크안함
	(손상호 주무관의 요청에 따라 [미리보는KOSIS]에서는 기간보안 체크안함.
 -->	
	<select id="selectDefaultPeriod" parameterClass="param" resultClass="string">
		<![CDATA[
		SELECT PRD_SE
		FROM
		(
			SELECT 	DISTINCT B.PRD_SE, C.PRD_SN
			FROM 	$dbUser$TN_STBL_RECD_INFO A, $dbUser$TN_RECD_PRD B, $dbUser$TC_PRD_INFO  C
				WHERE 	A.ORG_ID = #originOrgId# AND A.TBL_ID = #originTblId#
	            AND EXISTS
	                  (SELECT /*+ STAR */ P_DT.*
	                     FROM $dbUser$TN_DT P_DT, $dbUser$TN_STAT_INHERIT_INFO I, $dbUser$TN_DIM C_DIM
	                    WHERE     1 = 1
							AND P_DT.ORG_ID = #originOrgId#
							AND P_DT.TBL_ID = #originTblId# 
							AND P_DT.PRD_SE = B.PRD_SE
							AND P_DT.PRD_DE = B.PRD_DE
							AND I.ORG_ID = #orgId#
							AND I.TBL_ID = #tblId#
							AND I.ORG_ID = C_DIM.ORG_ID
							AND I.TBL_ID = C_DIM.TBL_ID
							AND C_DIM.ITM_RCGN_SN = P_DT.ITM_RCGN_SN
							AND ROWNUM = 1)
					AND A.ORG_ID = B.ORG_ID AND A.TBL_ID = B.TBL_ID
   					AND DECODE( (SELECT PUB_SE_TYPE FROM $dbUser$TN_STAT_INHERIT_INFO WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#), '1', A.PUB_SE, '1210110') 
   					 ]]>
   					<include refid="common.pub_se"/>
   					<![CDATA[
						AND A.PRD_SE = B.PRD_SE
						AND A.PRD_SE = C.PRD_SE
					]]>
					<isNotEqual property="serverType" compareValue="stat_emp">
						<isNotEqual property="serverTypeOrigin" compareValue="stat_emp">
							<include refid="selectPeriodPubSe"/>
						</isNotEqual>
					</isNotEqual>
					<![CDATA[
                       AND DECODE( (SELECT PUB_SE_TYPE FROM $dbUser$TN_STAT_INHERIT_INFO WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#), '1', B.PUB_SE, '1210110')
                        ]]>
   					<include refid="common.pub_se"/>
   					<![CDATA[
			ORDER BY C.PRD_SN
		)
		WHERE ROWNUM = 1
		]]>
	</select>

 	<!-- 시점 세팅 및 AJAX 같이 사용  -->
 	<!-- 2019.07.04 EXIST문이 느려서  STAR 힌트추가 -->
	<select id="selectPeriodInfoList"  resultClass="egovMap">
		<![CDATA[ 
		SELECT  B.PRD_SE,B.PRD_DE 
			 FROM (
		            SELECT S1.*, S2.PRD_SN FROM $dbUser$TN_STBL_RECD_INFO S1, $dbUser$TC_PRD_INFO S2 
		              WHERE ORG_ID=#originOrgId# AND TBL_ID=#originTblId# 
		                AND  
		            ]]>
		            <include refid="statinherit.inherit_pub_se"/>
		            <include refid="common.pub_se"/>
					<![CDATA[ 
					AND S1.PRD_SE = S2.PRD_SE
			) A , $dbUser$TN_RECD_PRD B
			WHERE 1=1
			AND A.ORG_ID = #originOrgId#
			AND A.TBL_ID = #originTblId# 
			AND A.ORG_ID = B.ORG_ID
			AND A.TBL_ID = B.TBL_ID 
			AND A.PRD_SE = B.PRD_SE
            AND EXISTS
                  (SELECT /*+ STAR */ P_DT.*
                     FROM $dbUser$TN_DT P_DT, $dbUser$TN_STAT_INHERIT_INFO I, $dbUser$TN_DIM C_DIM
                    WHERE     1 = 1
                        AND P_DT.ORG_ID = #originOrgId#
                        AND P_DT.TBL_ID = #originTblId# 
                        AND P_DT.PRD_SE = B.PRD_SE
                        AND P_DT.PRD_DE = B.PRD_DE
						AND I.ORG_ID = #orgId#
						AND I.TBL_ID = #tblId#
						AND I.ORG_ID = C_DIM.ORG_ID
						AND I.TBL_ID = C_DIM.TBL_ID
						AND C_DIM.ITM_RCGN_SN = P_DT.ITM_RCGN_SN
						AND ROWNUM = 1)
			]]>
			<isNotEqual property="serverType" compareValue="stat_emp">
				<isNotEqual property="serverTypeOrigin" compareValue="stat_emp">
					<include refid="selectPeriodPubSe"/>
				</isNotEqual>
			</isNotEqual>
			
		<isEmpty property="assayYn">
			<isNotEmpty prepend="AND" property="prdSe">
						A.PRD_SE = #prdSe#	
						AND B.PRD_DE BETWEEN #startPrd# AND #endPrd#
			</isNotEmpty>
		</isEmpty>
		<isNotEmpty property="assayYn">
			AND A.PRD_SE =#prdSe#
		</isNotEmpty>
		ORDER BY PRD_SN, PRD_DE
	</select>

	<!-- 주기가 F 인 경우 TN_STBL_RECD_INFO에서 상세주기를 가져온다. -->
	<select id="selectPrdDetail" parameterClass="param" resultClass="string">
		<![CDATA[
		SELECT	NVL(PRD_DETAIL, 'IR') AS PRD_DETAIL
		FROM	$dbUser$TN_STBL_RECD_INFO
		WHERE 	ORG_ID = #originOrgId#
				AND TBL_ID = #originTblId#
				AND PRD_SE = 'F'
		]]>
	</select>
	
	<!-- 특정 주기의 시점 가져오기 -->
	<sql id="selectPeriodList_mainClause">
		<![CDATA[
		SELECT 	PRD_DE
		FROM 	$dbUser$TN_RECD_PRD PRD
		WHERE 	ORG_ID = #originOrgId# AND TBL_ID = #originTblId#
				AND PRD_SE = #prdSe#
				AND PRD_DE BETWEEN #minDe# AND #maxDe#
				AND EXISTS (SELECT * FROM $dbUser$TN_DT DT
				                    WHERE ORG_ID = PRD.ORG_ID AND TBL_ID = PRD.TBL_ID AND PRD_SE = PRD.PRD_SE AND PRD_DE = PRD.PRD_DE
				                      AND EXISTS (SELECT * FROM $dbUser$TN_DIM
				                                          WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#
				                                            AND ITM_RCGN_SN = DT.ITM_RCGN_SN )
				                      AND ROWNUM = 1)
		]]>				
			<isNotEmpty property="scrapMinDe">
				AND PRD_DE BETWEEN #scrapMinDe# AND #scrapMaxDe#
			</isNotEmpty>
		<![CDATA[			
				AND 
		]]>
		<include refid="statinherit.inherit_pub_se"/>
		<include refid="common.pub_se"/>	
		<![CDATA[			
		ORDER BY PRD_DE DESC
     	]]>
	</sql>
	
	<select id="selectPeriodList" parameterClass="map" resultClass="hmap">
		<![CDATA[
		SELECT PRD_DE FROM (
		]]>
			<include refid="selectPeriodList_mainClause"/>
		<![CDATA[
		)
		]]>
		<isNotEmpty property="periodCnt">
			<![CDATA[
			WHERE ROWNUM <= #periodCnt#
			]]>
		</isNotEmpty>
	</select>
	
</sqlMap>