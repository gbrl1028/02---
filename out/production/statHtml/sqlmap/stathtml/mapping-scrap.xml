<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   "http://ibatis.apache.org/dtd/sql-map-2.dtd">   

<sqlMap namespace="scrap">
	
	<!-- 스크랩 폴더 조회(1레벨) -->
	<select id="selectMyscrapFolder_1" parameterClass="param" resultClass="hmap">
		<![CDATA[
		SELECT	ORDER_NO
				,EMP_ID
				,UP_FOLDER_ID
				,LVL
				,FOLDER_NAME
				,FOLDER_ID
				,(
					SELECT	COUNT(*) CNT 
		  		  	FROM 	$dbUser$TN_STBL_SCR_FOLDER 
		  		  	WHERE 	EMP_ID = #empId#
		  					AND UP_FOLDER_ID IS NULL) CNT                                                                      
        FROM 	$dbUser$TN_STBL_SCR_FOLDER 
		WHERE 	EMP_ID = #empId#
				AND UP_FOLDER_ID IS NULL   
				ORDER BY ORDER_NO
		]]>
	</select>
	
	<!-- 스크랩 폴더 조회(2레벨) -->
	<select id="selectMyscrapFolder_2" parameterClass="param" resultClass="hmap">
		<![CDATA[
		SELECT	ORDER_NO, EMP_ID, A.UP_FOLDER_ID, LVL, FOLDER_NAME, FOLDER_ID,
				NVL(B.CNT, 0) CNT
		FROM
		(
		    SELECT	ORDER_NO, EMP_ID, UP_FOLDER_ID, LVL, FOLDER_NAME, FOLDER_ID 
			FROM 	$dbUser$TN_STBL_SCR_FOLDER
			WHERE 	EMP_ID = #empId# AND LVL = 2
			ORDER BY UP_FOLDER_ID, ORDER_NO
		) A,
		(
		    SELECT	UP_FOLDER_ID, COUNT(*) CNT 
		    FROM 	$dbUser$TN_STBL_SCR_FOLDER 
		    WHERE 	EMP_ID = #empId#
		    GROUP BY UP_FOLDER_ID
		) B
		WHERE 	A.UP_FOLDER_ID = B.UP_FOLDER_ID
		ORDER BY ORDER_NO
		]]>
	</select>
	
	<!-- SCR_ID 가져오기 -->
	<select id="selectScrId" parameterClass="map" resultClass="string">
		<![CDATA[
		SELECT	NVL(MAX(TO_NUMBER(SCR_ID)), 0) + 1||'' SCR_ID
		FROM 	$dbUser$$tnStblScr$
        WHERE 	ORG_ID = #orgId#
           		AND TBL_ID = #tblId#     
           		AND EMP_ID = #empId# 
		]]>
	</select>
	
	<!-- TN_STBL_SCR - 데이터 넣기 -->
	<insert id="insertScrapData" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   '0', '1', #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '', '데이타', 
		   'data', 'zval', 'zval', 
		   'zval', 'zval', 
		   'val_unit', '', '', 
		   #folderId#, #func#
		   )
		]]>
	</insert>
	
	<!-- TN_STBL_SCR - 가중치 넣기 -->
	<insert id="insertScrapWgtCo" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   '0', '2', #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '', '가중치', 
		   'weight', 'wgt_co', 'wgt_co', 
		   'wgt_co', 'val_cmmt', 
		   'val_unit', '', '', 
		   #folderId#, #func#
		   )
		]]>
	</insert>
	
	<!-- TN_STBL_SCR - 함수값 넣기 -->
	<insert id="insertScrapFunc" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   '0', '3', #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '', '함수값', 
		   'func_val', 'func_val', 'func_val', 
		   'func_val', 'val_cmmt', 
		   'val_unit', '', '', 
		   #folderId#, #func#
		   )
		]]>
	</insert>
	
	<!-- TN_STBL_SCR - 항목 넣기 -->
	<insert id="insertScrapItem" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   #arrySe#, #arrySn#, #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '13999001', '항목', 
		   'Item', 'measure_cd', 'measure', 
		   'measure_en_nm', 'measure_cmmt', 
		   'measure_unit_nm', '', '', 
		   #folderId#, #func#
		   )
		]]>
	</insert>
	
	<select id="selectClassName" parameterClass="map" resultClass="hmap">
		<![CDATA[
		SELECT 	SCR_KOR, SCR_ENG, VAR_ORD_SN
		FROM 	$dbUser$TN_OBJ_ITM_CLS
        WHERE  	ORG_ID = #orgId#
           		AND TBL_ID = #tblId#    
           		AND OBJ_VAR_ID = #objVarId#
           ]]>
	</select>
	
	<!-- TN_STBL_SCR - 분류 넣기 -->
	<insert id="insertScrapClass" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   #arrySe#, #arrySn#, #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, #code#, #korName#, 
		   #engName#, 'dim'||#varOrdSn#||'_cd', 'dim'||#varOrdSn#, 
		   'dim'||#varOrdSn#||'_en_nm', 'dim'||#varOrdSn#||'_cmmt', 
		   'dim'||#varOrdSn#||'unit_nm', '', '', 
		   #folderId#, #func#
		   )
		]]>
	</insert>
	
	<!-- TN_STBL_SCR - 시점 넣기 -->
	<insert id="insertScrapPeriod" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC,
		   PARAM, PARAM_WEB
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   #arrySe#, #arrySn#, #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '', '시점', 
		   'period', 'prd_de', 'prd_de_nm', 
		   'prd_de_nm', '', 
		   '', '', '', 
		   #folderId#, #func#,
		   #param#, #paramWeb#
		   )
		]]>
	</insert>
	
	<!-- TN_STBL_SCR_ITM 넣기 -->
	<insert id="insertScrapTnStblScrItm" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScrItm$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   OBJ_VAR_ID, ITM_ID, UP_ITM_ID, CHAR_ITM_SN,
		   SCR_KOR, SCR_ENG, EMP_ID
		   ) 
		SELECT 	A.ORG_ID, A.TBL_ID, #scrId# AS SCR_ID, A.OBJ_VAR_ID, C.ITM_ID, C.UP_ITM_ID, C.CHAR_ITM_SN, C.SCR_KOR, C.SCR_ENG, #empId# AS EMP_ID
		FROM    $dbUser$TN_OBJ_ITM_CLS A, $condTable$ B, $dbUser$TN_ITM_LIST C
		WHERE 	A.ORG_ID = #orgId# AND A.TBL_ID = #tblId#
				AND A.OBJ_VAR_ID = '13999001'
				AND A.VAR_LVL_CO = 1
				AND B.SESSION_ID = #sessionId#
				AND B.TARGET_ID = 'ITM_ID'
				AND A.ORG_ID = C.ORG_ID
				AND A.TBL_ID = C.TBL_ID
				AND A.OBJ_VAR_ID = C.OBJ_VAR_ID
				AND B.TARGET_VALUE = C.ITM_ID
		UNION ALL
		SELECT 	A.ORG_ID, A.TBL_ID, #scrId# AS SCR_ID, A.OBJ_VAR_ID, C.ITM_ID, C.UP_ITM_ID, C.CHAR_ITM_SN, C.SCR_KOR, C.SCR_ENG, #empId# AS EMP_ID
		FROM    $dbUser$TN_OBJ_ITM_CLS A, $condTable$ B, $dbUser$TN_ITM_LIST C
		WHERE 	A.ORG_ID = #orgId# AND A.TBL_ID = #tblId#
				AND A.OBJ_VAR_ID != '13999001'
				AND A.VAR_LVL_CO = 1
				AND A.VAR_ORD_SN = SUBSTR(B.TARGET_ID, 5, 1)
				AND B.SESSION_ID = #sessionId#
				AND B.TARGET_ID LIKE 'OV_L%'
				AND A.ORG_ID = C.ORG_ID
				AND A.TBL_ID = C.TBL_ID
				AND A.OBJ_VAR_ID = C.OBJ_VAR_ID
				AND B.TARGET_VALUE = C.ITM_ID
		]]>
	</insert>
	
	<!-- TN_STBL_SCR - 파라미터 넣기 -->
	<insert id="insertScrapParams" parameterClass="map">
		<![CDATA[
		INSERT INTO $dbUser$$tnStblScr$ (
		   ORG_ID, TBL_ID, SCR_ID, 
		   ARRY_SE, ARRY_SN, EMP_ID, 
		   VAR_LVL_CO, ARRY_CPST_SE, 
		   LST_CHN_DE, LST_CHN_NM,
		   TBL_NM_ALIAS, CODE, KOR_NAME, 
		   ENG_NAME, COLNAME, KOR_COL, 
		   ENG_COL, CMMT_COL, 
		   UNIT_COL, UNIT_NM, COLLAPSE_FG, 
		   FOLDER_ID, FUNC, PARAM_WEB
		   ) 
		VALUES (
		   #orgId#, #tblId#, #scrId#, 
		   '0', #arrySn#, #empId#, 
		   1, '1', 
		   TO_CHAR(SYSDATE, 'YYYYMMDD'), '',
		   #tblNmAlias#, '', '파라미터', 
		   'params', 'params', '', 
		   '', '', 
		   '', '', '', 
		   #folderId#, #func#, #paramWeb#
		   )
		]]>
	</insert>
	
	<select id="getTmpStatPrdListForScrap" parameterClass="map" resultClass="int">
		<![CDATA[
		SELECT COUNT(*)CNT FROM TN_RECD_PRD 
		WHERE ORG_ID = #orgId# AND TBL_ID = #tblId#
		AND PRD_SE = #prdSe# AND PRD_DE >= #prdDe#
        AND PUB_SE 
   		]]>
		<include refid="common.pub_se"/>
	</select>
</sqlMap>