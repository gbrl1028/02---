<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="metainfo">

	<!-- 통계표 명칭 및 자료다운일자, 수록시점, 통계표단위 -->
	<select id="selectTblNm" parameterClass="param" resultClass="egovMap">
		<![CDATA[
		SELECT	CASE
					WHEN INSTR(#dataOpt#, 'en') > 0 THEN
						TBL_ENG_NM
					ELSE
						TBL_NM
				END AS TBL_NM
  				, TO_CHAR(SYSDATE, 'YYYY.MM.DD HH24:MI') AS DOWN_DATE
  				, $dbUser$FN_GET_STBL_PRD_SEARCH(A.ORG_ID, A.TBL_ID, #dbUser#, #serverType#, #language#, #dataOpt#) AS CONTAIN_PERIOD
  				, CASE
  					WHEN UNIT_ID IS NULL THEN
  						''
  					WHEN INSTR(#dataOpt#, 'en') > 0 THEN
  						( SELECT CD_ENG_NM FROM $dbUser$TC_UNIT WHERE CD_ID = A.UNIT_ID )
  					ELSE
  						( SELECT CD_NM FROM $dbUser$TC_UNIT WHERE CD_ID = A.UNIT_ID )
				END AS UNIT
  		FROM 	$dbUser$TN_STBL_INFO A
 		WHERE 	ORG_ID = #orgId#
 				AND TBL_ID = #tblId#
		]]>
	</select>

	<!-- 주기 명칭 -->
	<select id="selectPrdNm" parameterClass="map" resultClass="egovMap">
		<![CDATA[
		SELECT	CASE
  					WHEN INSTR(#dataOpt#, 'en') > 0 THEN
  						PRD_ENG_NM
  					ELSE
  						PRD_NM
				END AS PRD_NM
  		FROM 	$dbUser$TC_PRD_INFO
 		WHERE 	PRD_SE = #prdSe#
		]]>
	</select>

	<!-- 주기 명칭 부정기 일 경우-->
	<select id="selectPrdNmF" parameterClass="map" resultClass="egovMap">
		<![CDATA[
		SELECT CASE
		          WHEN INSTR(#dataOpt#, 'en') > 0 THEN PRD_ENG_NM
		          ELSE PRD_NM
		       END
		          AS PRD_NM
		  FROM $dbUser$TC_PRD_DETAIL
		 WHERE PRD_DETAIL = (SELECT NVL(PRD_DETAIL, 'IR') FROM $dbUser$TN_STBL_RECD_INFO WHERE ORG_ID = #orgId# AND TBL_ID = #tblId# AND PRD_SE = 'F')
		]]>
	</select>

	<select id="selectCmmtList" parameterClass="map" resultClass="egovMap">
		<![CDATA[
		SELECT	A.CMMT_DC
				, A.CMMT_SE
		        , CASE
		            WHEN INSTR(#dataOpt#, 'en') > 0 THEN
		                'TABLE : '
		            ELSE
		                '통계표 : '
		        END AS TITLE
		        , 0 AS SN
		        , RANK() OVER(PARTITION BY A.ORG_ID, A.TBL_ID ORDER BY LINE_SN) RNUM
		FROM     $dbUser$TN_CMMT_INFO A, $dbUser$TN_STBL_INFO B
		WHERE    A.ORG_ID = B.ORG_ID
		         AND A.TBL_ID = B.TBL_ID
		         AND A.ORG_ID = #orgId#
		         AND A.TBL_ID = #tblId#
		         AND A.CMMT_SE = '1210610'
		         AND A.LNG_SE = #lngSe#
		UNION ALL
		SELECT	A.CMMT_DC
				, A.CMMT_SE
		        , CASE
		            WHEN INSTR(#dataOpt#, 'en') > 0 THEN
		                'Item > '||B.SCR_ENG||' : '
		            ELSE
		                '항목 > '||B.SCR_KOR||' : '
		        END AS TITLE
		        , B.CHAR_ITM_SN AS SN
		        , RANK() OVER(PARTITION BY A.ITM_ID ORDER BY LINE_SN) RNUM
		FROM    $dbUser$TN_CMMT_INFO A, $dbUser$TN_ITM_LIST B
		WHERE   A.ORG_ID = B.ORG_ID
		        AND A.TBL_ID = B.TBL_ID
		        AND A.ORG_ID = #orgId#
		        AND A.TBL_ID = #tblId#
		        AND A.VAR_LVL_CO = '1'
		        AND A.ITM_ID = B.ITM_ID
		        AND A.OBJ_VAR_ID = B.OBJ_VAR_ID
		        AND B.OBJ_VAR_ID = '13999001'
		        AND A.CMMT_SE = '1210611'
		        AND A.LNG_SE = #lngSe#
		        AND B.ITM_ID IN (SELECT TARGET_VALUE FROM $condTable$ WHERE SESSION_ID = #sessionId# AND TARGET_ID = 'ITM_ID')
		UNION ALL
		SELECT  A.CMMT_DC
				, A.CMMT_SE
		        , CASE
		            WHEN INSTR(#dataOpt#, 'en') > 0 THEN
		                B.SCR_ENG||' : '
		            ELSE
		                B.SCR_KOR||' : '
		        END AS TITLE
		        , B.VAR_ORD_SN AS SN
		        , RANK() OVER(PARTITION BY A.OBJ_VAR_ID ORDER BY LINE_SN) RNUM
		FROM	$dbUser$TN_CMMT_INFO A, $dbUser$TN_OBJ_ITM_CLS B
		WHERE	A.ORG_ID = B.ORG_ID
		        AND A.TBL_ID = B.TBL_ID
		        AND A.ORG_ID = #orgId#
		        AND A.TBL_ID = #tblId#
		        AND A.VAR_LVL_CO = '1'
		        AND A.OBJ_VAR_ID = B.OBJ_VAR_ID
		        AND B.OBJ_VAR_ID != '13999001'
		        AND A.CMMT_SE = '1210612'
		        AND A.LNG_SE = #lngSe#
		        AND B.VAR_ORD_SN IN (SELECT DISTINCT SUBSTR(TARGET_ID, 5, 1) FROM $condTable$ WHERE SESSION_ID = #sessionId# AND TARGET_ID LIKE 'OV_L%')
		UNION ALL
		SELECT  A.CMMT_DC
				, A.CMMT_SE
		         , CASE
		            WHEN INSTR(#dataOpt#, 'en') > 0 THEN
		                (SELECT SCR_ENG FROM $dbUser$TN_OBJ_ITM_CLS WHERE ORG_ID = B.ORG_ID AND TBL_ID = B.TBL_ID AND OBJ_VAR_ID = B.OBJ_VAR_ID)||' > '||B.SCR_ENG||' : '
		            ELSE
		                (SELECT SCR_KOR FROM $dbUser$TN_OBJ_ITM_CLS WHERE ORG_ID = B.ORG_ID AND TBL_ID = B.TBL_ID AND OBJ_VAR_ID = B.OBJ_VAR_ID)||' > '||B.SCR_KOR||' : '
		        END AS TITLE
		        , B.CHAR_ITM_SN AS SN
		        , RANK() OVER(PARTITION BY A.ITM_ID ORDER BY LINE_SN) RNUM
		FROM	$dbUser$TN_CMMT_INFO A, $dbUser$TN_ITM_LIST B
		WHERE	A.ORG_ID = B.ORG_ID
		        AND A.TBL_ID = B.TBL_ID
		        AND A.ORG_ID = #orgId#
		        AND A.TBL_ID = #tblId#
		        AND A.VAR_LVL_CO = '1'
		        AND A.ITM_ID = B.ITM_ID
		        AND A.OBJ_VAR_ID = B.OBJ_VAR_ID
		        AND B.OBJ_VAR_ID != '13999001'
		        AND A.CMMT_SE = '1210613'
		        AND A.LNG_SE = #lngSe#
		        AND (B.OBJ_VAR_ID, B.ITM_ID) IN (SELECT (SELECT OBJ_VAR_ID FROM $dbUser$TN_OBJ_ITM_CLS WHERE ORG_ID = #orgId# AND TBL_ID = #tblId# AND VAR_ORD_SN = SUBSTR(TARGET_ID, 5, 1)) AS OBJ_VAR_ID, TARGET_VALUE FROM $condTable$ A WHERE SESSION_ID = #sessionId# AND TARGET_ID LIKE 'OV_L%')
		ORDER BY CMMT_SE, SN, RNUM
		]]>
	</select>

</sqlMap>